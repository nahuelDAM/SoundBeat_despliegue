import{a as h,b as z}from"./chunk-MR5KIQS6.js";import{a as F}from"./chunk-OZVMT2OP.js";import{A as L,C as V,D as H,a as U,x as N}from"./chunk-APCY6S75.js";import{$ as D,A as p,B as d,C as g,F as O,G as k,H as f,M as E,N as I,P as M,Z as R,b,bb as B,c as u,i as v,l as S,m as P,q as T,r as y,t as j,u as $,v as _,x,y as C,z as w}from"./chunk-7KKY7EE3.js";var A=(()=>{let i=class i{constructor(){this.currentSampleSubject=new b(null),this.isPlayingSubject=new b(!1),this.playbackProgressSubject=new b(0),this.currentPlaybackTimeSubject=new b(0),this.playlistSubject=new b([]),this.historialReproduccionSubject=new b([]),this.audioElement=null,this.currentSample$=this.currentSampleSubject.asObservable(),this.isPlaying$=this.isPlayingSubject.asObservable(),this.playbackProgress$=this.playbackProgressSubject.asObservable(),this.currentPlaybackTime$=this.currentPlaybackTimeSubject.asObservable(),this.playlist$=this.playlistSubject.asObservable(),this.historialReproduccion$=this.historialReproduccionSubject.asObservable(),this.updatePlaybackInfo=()=>{if(!this.audioElement)return;let e=this.audioElement.currentTime,t=this.audioElement.duration,r=e/t*100;this.currentPlaybackTimeSubject.next(e),this.playbackProgressSubject.next(r)},this.handleTrackEnd=()=>{this.playNext()},this.loadPlayerState(),this.loadHistorial()}get currentSample(){return this.currentSampleSubject.value}get isPlaying(){return this.isPlayingSubject.value}get playbackProgress(){return this.playbackProgressSubject.value}get currentPlaybackTime(){return this.currentPlaybackTimeSubject.value}get playlist(){return this.playlistSubject.value}get historialReproduccion(){return this.historialReproduccionSubject.value}playSample(e,t=[]){if(this.currentSample&&this.currentSample.id===e.id){this.togglePlayPause();return}this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.removeEventListener("ended",this.handleTrackEnd)),this.currentSampleSubject.next(e),t.length>0&&this.playlistSubject.next(t),this.playbackProgressSubject.next(0),this.currentPlaybackTimeSubject.next(0),this.audioElement=new Audio(e.url),this.audioElement.addEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.addEventListener("ended",this.handleTrackEnd),this.audioElement.play().then(()=>{this.isPlayingSubject.next(!0),this.addToHistorial(e),this.savePlayerState()}).catch(r=>{console.error("Error al reproducir el audio:",r),this.isPlayingSubject.next(!1)})}togglePlayPause(){!this.audioElement||!this.currentSample||(this.isPlaying?(this.audioElement.pause(),this.isPlayingSubject.next(!1)):this.audioElement.play().then(()=>{this.isPlayingSubject.next(!0)}).catch(e=>{console.error("Error al reproducir el audio:",e)}),this.savePlayerState())}playNext(){if(!this.currentSample)return;let e=this.playlist,t=e.findIndex(r=>{var n;return r.id===((n=this.currentSample)==null?void 0:n.id)});t!==-1&&t<e.length-1?this.playSample(e[t+1]):e.length>0&&this.playSample(e[0])}playPrevious(){if(!this.currentSample)return;let e=this.playlist,t=e.findIndex(r=>{var n;return r.id===((n=this.currentSample)==null?void 0:n.id)});t>0?this.playSample(e[t-1]):e.length>0&&this.playSample(e[e.length-1])}seekTo(e){if(!this.audioElement||!this.currentSample)return;let t=this.audioElement.duration,r=e/100*t;this.audioElement.currentTime=r,this.currentPlaybackTimeSubject.next(r),this.playbackProgressSubject.next(e)}stop(){this.audioElement&&(this.audioElement.pause(),this.audioElement.currentTime=0,this.isPlayingSubject.next(!1),this.playbackProgressSubject.next(0),this.currentPlaybackTimeSubject.next(0),this.savePlayerState())}addToHistorial(e){let t=[...this.historialReproduccion];t=t.filter(r=>r.id!==e.id),t.unshift(e),t.length>5&&(t=t.slice(0,5)),this.historialReproduccionSubject.next(t),localStorage.setItem("historialReproduccion",JSON.stringify(t))}loadHistorial(){let e=localStorage.getItem("historialReproduccion");if(e)try{let t=JSON.parse(e);this.historialReproduccionSubject.next(t)}catch(t){console.error("Error al cargar el historial de reproducci\xF3n:",t)}}savePlayerState(){let e={currentSample:this.currentSample,isPlaying:this.isPlaying,currentTime:this.currentPlaybackTime,playlist:this.playlist};localStorage.setItem("playerState",JSON.stringify(e))}loadPlayerState(){let e=localStorage.getItem("playerState");if(e)try{let t=JSON.parse(e);t.currentSample&&(this.currentSampleSubject.next(t.currentSample),this.playlistSubject.next(t.playlist||[]),this.isPlayingSubject.next(!1),this.currentPlaybackTimeSubject.next(t.currentTime||0),this.audioElement=new Audio(t.currentSample.url),this.audioElement.currentTime=t.currentTime||0,this.audioElement.addEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.addEventListener("ended",this.handleTrackEnd))}catch(t){console.error("Error al cargar el estado del reproductor:",t)}}ngOnDestroy(){this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.removeEventListener("ended",this.handleTrackEnd),this.audioElement=null)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function q(a,i){if(a&1){let o=O();p(0,"div",1)(1,"div",2),k("click",function(t){S(o);let r=f();return P(r.onProgressBarClick(t))}),g(2,"div",3),d(),p(3,"div",4)(4,"div",5),g(5,"img",6),d(),p(6,"div",7)(7,"h4"),E(8),d(),p(9,"p"),E(10),d()(),p(11,"div",8)(12,"button",9),k("click",function(){S(o);let t=f();return P(t.playPrevious())}),g(13,"ion-icon",10),d(),p(14,"button",11),k("click",function(){S(o);let t=f();return P(t.togglePlayPause())}),g(15,"ion-icon",12),d(),p(16,"button",9),k("click",function(){S(o);let t=f();return P(t.playNext())}),g(17,"ion-icon",13),d()()()()}if(a&2){let o=f();w("dark-mode",o.darkMode),y(2),C("width",o.playbackProgress,"%"),y(3),x("src","/assets/img/sample-placeholder.jpg",T),y(3),I(o.currentSample.nombre),y(2),M("",o.formatDuration(o.currentPlaybackTime)," / ",o.formatDuration(o.currentSample.duracion),""),y(5),x("name",o.isPlaying?"pause":"play")}}var re=(()=>{let i=class i{constructor(e,t){this.playerService=e,this.themeService=t,this.currentSample=null,this.isPlaying=!1,this.playbackProgress=0,this.currentPlaybackTime=0,this.darkMode=!1,this.subscriptions=[],U({play:L,pause:N,playSkipBackOutline:V,playSkipForwardOutline:H})}ngOnInit(){this.subscriptions.push(this.playerService.currentSample$.subscribe(e=>{this.currentSample=e}),this.playerService.isPlaying$.subscribe(e=>{this.isPlaying=e}),this.playerService.playbackProgress$.subscribe(e=>{this.playbackProgress=e}),this.playerService.currentPlaybackTime$.subscribe(e=>{this.currentPlaybackTime=e}),this.themeService.isDarkMode().subscribe(e=>{this.darkMode=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}togglePlayPause(){this.playerService.togglePlayPause()}playNext(){this.playerService.playNext()}playPrevious(){this.playerService.playPrevious()}onProgressBarClick(e){let r=e.currentTarget.getBoundingClientRect(),s=(e.clientX-r.left)/r.width*100;this.playerService.seekTo(s)}formatDuration(e){let t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0":""}${r}`}};i.\u0275fac=function(t){return new(t||i)(j(A),j(F))},i.\u0275cmp=$({type:i,selectors:[["app-player"]],decls:1,vars:1,consts:[["class","floating-player",3,"dark-mode",4,"ngIf"],[1,"floating-player"],[1,"player-progress",3,"click"],[1,"progress-bar"],[1,"player-content"],[1,"player-thumbnail"],["alt","Sample thumbnail",3,"src"],[1,"player-info"],[1,"player-controls"],[1,"control-button",3,"click"],["name","play-skip-back-outline"],[1,"control-button","play-pause",3,"click"],[3,"name"],["name","play-skip-forward-outline"]],template:function(t,r){t&1&&_(0,q,18,9,"div",0),t&2&&x("ngIf",r.currentSample)},dependencies:[D,R,B],styles:[".floating-player[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:var(--card-background);box-shadow:0 -4px 20px #0000001a;z-index:1000;transition:all .3s ease}.player-progress[_ngcontent-%COMP%]{height:3px;background:var(--progress-background);position:relative;cursor:pointer}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--primary-color);transition:width .1s linear}.player-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 20px}.player-thumbnail[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:10px;overflow:hidden;margin-right:15px}.player-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.player-info[_ngcontent-%COMP%]{flex:1;min-width:0}.player-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:var(--text-color);margin:0 0 5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.player-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted);margin:0}.player-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.control-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--action-button-background);color:var(--text-color);border:none;cursor:pointer;transition:all .2s ease}.control-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.control-button.play-pause[_ngcontent-%COMP%]{width:44px;height:44px;background:var(--primary-color);color:#fff}.control-button.play-pause[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}[_nghost-%COMP%]{--background-color: #f5f5f5;--card-background: #ffffff;--text-color: #333333;--text-muted: #666666;--input-background: #f0f0f0;--input-placeholder: #9e9e9e;--primary-color: #e491b4;--border-color: rgba(0, 0, 0, .1);--tag-background: #f0f0f0;--tag-color: #666666;--action-button-background: #f5f5f5;--action-button-hover: #eeeeee;--progress-background: #eeeeee;--loader-color: #eeeeee}.dark-mode[_ngcontent-%COMP%]{--background-color: #121212;--card-background: #1e1e1e;--text-color: #ffffff;--text-muted: #aaaaaa;--input-background: #2d2d2d;--input-placeholder: #9e9e9e;--border-color: rgba(255, 255, 255, .1);--tag-background: #2d2d2d;--tag-color: #dddddd;--action-button-background: #2d2d2d;--action-button-hover: #3d3d3d;--progress-background: #2d2d2d;--loader-color: #2d2d2d}"]});let a=i;return a})();var se=(()=>{let i=class i{constructor(){this.baseUrl=`${z.URLbase}/api/samples`}obtenerSamplesPorInstrumento(e,t=0,r=10,n="nombre",s="asc"){let l=`${this.baseUrl}/instrumento/${e}?page=${t}&size=${r}&sortBy=${n}&sortDirection=${s}`;return u(h.get({url:l,headers:{"Content-Type":"application/json"}}).then(c=>c.data))}obtenerSamplesPorGenero(e,t=0,r=10,n="nombre",s="asc"){let l=`${this.baseUrl}/genero/${e}?page=${t}&size=${r}&sortBy=${n}&sortDirection=${s}`;return u(h.get({url:l,headers:{"Content-Type":"application/json"}}).then(c=>c.data))}obtenerSamplesPorGeneroYTipo(e,t,r=0,n=10,s="nombre",l="asc"){let c=`${this.baseUrl}/genero/${e}/tipo/${t}?page=${r}&size=${n}&sortBy=${s}&sortDirection=${l}`;return u(h.get({url:c,headers:{"Content-Type":"application/json"}}).then(m=>m.data))}obtenerSamplesPorInstrumentoYTipo(e,t,r=0,n=10,s="nombre",l="asc"){let c=`${this.baseUrl}/genero/${e}/tipo/${t}?page=${r}&size=${n}&sortBy=${s}&sortDirection=${l}`;return u(h.get({url:c,headers:{"Content-Type":"application/json"}}).then(m=>m.data))}buscarSamples(e,t,r,n=0,s=10,l="nombre",c="asc"){let m=`${this.baseUrl}/buscar?query=${encodeURIComponent(e)}&page=${n}&size=${s}&sortBy=${l}&sortDirection=${c}`;return t!==void 0&&(m+=`&generoId=${t}`),r!==void 0&&(m+=`&tipoId=${r}`),u(h.get({url:m,headers:{"Content-Type":"application/json"}}).then(G=>G.data))}obtenerSamplesMasPopulares(){let e=`${this.baseUrl}/populares`;return u(h.get({url:e,headers:{"Content-Type":"application/json"}}).then(t=>t.data))}obtenerSamplesMasRecientes(){let e=`${this.baseUrl}/recientes`;return u(h.get({url:e,headers:{"Content-Type":"application/json"}}).then(t=>t.data))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();export{A as a,re as b,se as c};
