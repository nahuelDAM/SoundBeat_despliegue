import{b as g,c as X}from"./chunk-5NEJBAS5.js";import{Ab as j,D as d,F as f,H as M,Hb as N,Ja as A,K as _,Kb as O,Kc as Z,M as h,Ma as L,Mb as B,Q as a,Qb as D,R as s,Ra as F,S as C,Tb as z,X as I,_a as H,_b as W,ac as x,ea as u,ec as G,f as p,fa as S,ga as v,gc as V,ic as q,ja as U,ka as E,la as T,oc as J,p as y,pc as K,tc as Q,ua as k,va as $,vc as Y,ya as w,zb as P}from"./chunk-5RLBJS7C.js";import{f as R}from"./chunk-RW4GY4BD.js";var ee=(()=>{let n=class n{constructor(){this.apiUrl=`${X.URLbase}/api/admin/usuarios`}getUsers(t,i,e="id,asc",o){let l=`${this.apiUrl}?page=${t}&size=${i}&sort=${e}`;o&&(l+=`&search=${encodeURIComponent(o)}`);let c=g.get({url:l,headers:this._getAuthHeaders()}).then(m=>{if(m.status>=200&&m.status<300)return m.data;throw{status:m.status,error:m.data}});return p(c)}getUserById(t){let i=`${this.apiUrl}/${t}`,e=g.get({url:i,headers:this._getAuthHeaders()}).then(o=>{if(o.status>=200&&o.status<300)return o.data;throw{status:o.status,error:o.data}});return p(e)}updateUserRole(t,i){let e=`${this.apiUrl}/${t}/rol`,o={rol:i},l=g.put({url:e,headers:this._getAuthHeaders(),data:o}).then(c=>{if(c.status>=200&&c.status<300)return c.data;throw{status:c.status,error:c.data}});return p(l)}deleteUser(t){let i=`${this.apiUrl}/${t}`,e=g.delete({url:i,headers:this._getAuthHeaders()}).then(o=>{if(!(o.status>=200&&o.status<300))throw{status:o.status,error:o.data}});return p(e)}_getAuthHeaders(){let t=localStorage.getItem("token"),i={"Content-Type":"application/json"};return t&&(i.Authorization=`Bearer ${t}`),i}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function oe(r,n){if(r&1&&(a(0,"ion-select-option",8),u(1),s()),r&2){let b=n.$implicit;h("value",b),d(),v(" ",b," ")}}function ne(r,n){r&1&&C(0,"ion-spinner",9)}var fe=(()=>{let n=class n{constructor(t,i,e){this.modalController=t,this.userAdminService=i,this.toastController=e,this.isLoading=!1,this.selectedRole="",this.availableRoles=["USER","ADMIN"],Y({closeOutline:Z})}ngOnInit(){this.user&&(this.selectedRole=this.user.rol)}dismiss(t){this.modalController.dismiss(t)}saveChanges(){if(this.selectedRole===this.user.rol){this.dismiss();return}this.isLoading=!0,this.userAdminService.updateUserRole(this.user.id,this.selectedRole).subscribe({next:()=>{this.isLoading=!1,this.dismiss({saved:!0})},error:t=>{this.isLoading=!1,console.error("Error al actualizar el rol:",t),this.presentToast("Error al actualizar el rol.","danger")}})}presentToast(t,i){return R(this,null,function*(){(yield this.toastController.create({message:t,duration:3e3,position:"top",color:i})).present()})}};n.\u0275fac=function(i){return new(i||n)(f(q),f(ee),f(J))},n.\u0275cmp=M({type:n,selectors:[["app-change-role-modal"]],inputs:{user:"user"},decls:25,vars:6,consts:[["slot","end"],[3,"click"],["name","close-outline","slot","icon-only"],[1,"ion-padding"],["label","Nuevo Rol","label-placement","stacked","ngDefaultControl","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["strong","",3,"click","disabled"],["name","crescent","slot","start",4,"ngIf"],[3,"value"],["name","crescent","slot","start"]],template:function(i,e){i&1&&(a(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),u(3,"Cambiar Rol de Usuario"),s(),a(4,"ion-buttons",0)(5,"ion-button",1),I("click",function(){return e.dismiss()}),C(6,"ion-icon",2),s()()()(),a(7,"ion-content",3)(8,"p"),u(9,"Est\xE1s editando el rol para "),a(10,"strong"),u(11),s(),u(12),s(),a(13,"ion-list")(14,"ion-item")(15,"ion-select",4),T("ngModelChange",function(l){return E(e.selectedRole,l)||(e.selectedRole=l),l}),_(16,oe,2,2,"ion-select-option",5),s()()()(),a(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",0)(20,"ion-button",1),I("click",function(){return e.dismiss()}),u(21,"Cancelar"),s(),a(22,"ion-button",6),I("click",function(){return e.saveChanges()}),_(23,ne,1,0,"ion-spinner",7),u(24," Guardar "),s()()()()),i&2&&(d(11),S(e.user.nombreUsuario),d(),v(" (",e.user.email,")."),d(3),U("ngModel",e.selectedRole),d(),h("ngForOf",e.availableRoles),d(6),h("disabled",e.isLoading||e.selectedRole==e.user.rol),d(),h("ngIf",e.isLoading))},dependencies:[K,D,z,x,P,j,O,N,B,G,V,w,k,$,H,A,L,F,W,Q],encapsulation:2});let r=n;return r})();export{ee as a,fe as b};
