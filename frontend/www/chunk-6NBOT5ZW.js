import{b as H}from"./chunk-KUJJENDQ.js";import{a as A}from"./chunk-XTSUAW32.js";import{b as v,c as U}from"./chunk-5NEJBAS5.js";import{C,D as p,F as k,H as F,K as w,M as y,N as O,O as I,Q as c,R as l,S as u,W as M,X as g,Y as d,b as S,d as x,ea as P,f as m,fa as j,ha as $,hd as D,nd as V,p as b,pc as B,q as _,qd as N,rd as z,t as h,u as f,va as T,vc as E,ya as L}from"./chunk-5RLBJS7C.js";function R(o,i){if(o&1){let a=M();c(0,"div",1)(1,"div",2),g("click",function(t){h(a);let r=d();return f(r.onProgressBarClick(t))}),u(2,"div",3),l(),c(3,"div",4)(4,"div",5),u(5,"img",6),l(),c(6,"div",7)(7,"h4"),P(8),l(),c(9,"p"),P(10),l()(),c(11,"div",8)(12,"button",9),g("click",function(){h(a);let t=d();return f(t.playPrevious())}),u(13,"ion-icon",10),l(),c(14,"button",11),g("click",function(){h(a);let t=d();return f(t.togglePlayPause())}),u(15,"ion-icon",12),l(),c(16,"button",9),g("click",function(){h(a);let t=d();return f(t.playNext())}),u(17,"ion-icon",13),l()()()()}if(o&2){let a=d();I("dark-mode",a.darkMode),p(2),O("width",a.playbackProgress,"%"),p(3),y("src","/assets/img/sample-placeholder.jpg",C),p(3),j(a.currentSample.nombre),p(2),$("",a.formatDuration(a.currentPlaybackTime)," / ",a.formatDuration(a.currentSample.duracion),""),p(5),y("name",a.isPlaying?"pause":"play")}}var te=(()=>{let i=class i{constructor(e,t){this.playerService=e,this.themeService=t,this.currentSample=null,this.isPlaying=!1,this.playbackProgress=0,this.currentPlaybackTime=0,this.darkMode=!1,this.subscriptions=[],E({play:V,pause:D,playSkipBackOutline:N,playSkipForwardOutline:z})}ngOnInit(){this.subscriptions.push(this.playerService.currentSample$.subscribe(e=>{this.currentSample=e}),this.playerService.isPlaying$.subscribe(e=>{this.isPlaying=e}),this.playerService.playbackProgress$.subscribe(e=>{this.playbackProgress=e}),this.playerService.currentPlaybackTime$.subscribe(e=>{this.currentPlaybackTime=e}),this.themeService.isDarkMode().subscribe(e=>{this.darkMode=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}togglePlayPause(){this.playerService.togglePlayPause()}playNext(){this.playerService.playNext()}playPrevious(){this.playerService.playPrevious()}onProgressBarClick(e){let r=e.currentTarget.getBoundingClientRect(),s=(e.clientX-r.left)/r.width*100;this.playerService.seekTo(s)}formatDuration(e){let t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0":""}${r}`}};i.\u0275fac=function(t){return new(t||i)(k(H),k(A))},i.\u0275cmp=F({type:i,selectors:[["app-player"]],decls:1,vars:1,consts:[["class","floating-player",3,"dark-mode",4,"ngIf"],[1,"floating-player"],[1,"player-progress",3,"click"],[1,"progress-bar"],[1,"player-content"],[1,"player-thumbnail"],["alt","Sample thumbnail",3,"src"],[1,"player-info"],[1,"player-controls"],[1,"control-button",3,"click"],["name","play-skip-back-outline"],[1,"control-button","play-pause",3,"click"],[3,"name"],["name","play-skip-forward-outline"]],template:function(t,r){t&1&&w(0,R,18,9,"div",0),t&2&&y("ngIf",r.currentSample)},dependencies:[L,T,B],styles:[".floating-player[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:var(--card-background);box-shadow:0 -4px 20px #0000001a;z-index:1000;transition:all .3s ease}.player-progress[_ngcontent-%COMP%]{height:3px;background:var(--progress-background);position:relative;cursor:pointer}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--primary-color);transition:width .1s linear}.player-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 20px}.player-thumbnail[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:10px;overflow:hidden;margin-right:15px}.player-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.player-info[_ngcontent-%COMP%]{flex:1;min-width:0}.player-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:var(--text-color);margin:0 0 5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.player-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted);margin:0}.player-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.control-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--action-button-background);color:var(--text-color);border:none;cursor:pointer;transition:all .2s ease}.control-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.control-button.play-pause[_ngcontent-%COMP%]{width:44px;height:44px;background:var(--primary-color);color:#fff}.control-button.play-pause[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}[_nghost-%COMP%]{--background-color: #f5f5f5;--card-background: #ffffff;--text-color: #333333;--text-muted: #666666;--input-background: #f0f0f0;--input-placeholder: #9e9e9e;--primary-color: #e491b4;--border-color: rgba(0, 0, 0, .1);--tag-background: #f0f0f0;--tag-color: #666666;--action-button-background: #f5f5f5;--action-button-hover: #eeeeee;--progress-background: #eeeeee;--loader-color: #eeeeee}.dark-mode[_ngcontent-%COMP%]{--background-color: #121212;--card-background: #1e1e1e;--text-color: #ffffff;--text-muted: #aaaaaa;--input-background: #2d2d2d;--input-placeholder: #9e9e9e;--border-color: rgba(255, 255, 255, .1);--tag-background: #2d2d2d;--tag-color: #dddddd;--action-button-background: #2d2d2d;--action-button-hover: #3d3d3d;--progress-background: #2d2d2d;--loader-color: #2d2d2d}"]});let o=i;return o})();var q=(()=>{let i=class i{constructor(){this.baseUrl=`${U.URLbase}/api/usuarios-samples`}obtenerSamplesDelUsuario(e){let t=`${this.baseUrl}/${e}/samples`;return m(v.get({url:t,headers:this._getAuthHeaders()}).then(r=>r.data))}darLike(e,t){let r=`${this.baseUrl}`,n={usuarioId:e,sampleId:t};return m(v.post({url:r,headers:this._getAuthHeaders(),data:n}).then(s=>s.data))}quitarLike(e,t){let r=`${this.baseUrl}/usuario/${e}/sample/${t}`;return m(v.delete({url:r,headers:this._getAuthHeaders()}).then(n=>n.data))}existeLike(e,t){let r=`${this.baseUrl}/existe?usuarioId=${e}&sampleId=${t}`;return m(v.get({url:r,headers:this._getAuthHeaders()}).then(n=>n.data))}_getAuthHeaders(){let e=localStorage.getItem("token"),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var se=(()=>{let i=class i{constructor(e){this.usuarioSampleService=e,this.favoritesSubject=new x([]),this.favoriteSamplesSubject=new x([]),this.favorites$=this.favoritesSubject.asObservable(),this.favoriteSamples$=this.favoriteSamplesSubject.asObservable(),this.usuarioId=this.getIdUser(),this.loadFavoritesFromBackend()}loadFavoritesFromBackend(){this.usuarioSampleService.obtenerSamplesDelUsuario(this.usuarioId).subscribe({next:e=>{let t=e.map(r=>r.id);this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(e),localStorage.setItem("favoriteSamples",JSON.stringify(t))},error:e=>{console.error("Error al cargar favoritos:",e),this.loadFromLocalStorage()}})}loadFromLocalStorage(){let e=localStorage.getItem("favoriteSamples");if(e){let t=JSON.parse(e);this.favoritesSubject.next(t)}}getIdUser(){return parseInt(localStorage.getItem("idUsuario")||"")}get currentFavorites(){return this.favoritesSubject.value}get currentFavoriteSamples(){return this.favoriteSamplesSubject.value}isFavorite(e){return this.currentFavorites.includes(e)}addToFavorites(e){let t=[...this.currentFavorites],r=[...this.currentFavoriteSamples];return t.includes(e.id)||(t.push(e.id),r.push(e),this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(r),localStorage.setItem("favoriteSamples",JSON.stringify(t))),new S(n=>{this.usuarioSampleService.darLike(this.usuarioId,e.id).subscribe({next:s=>{console.log("Like a\xF1adido exitosamente"),n.next(s),n.complete()},error:s=>{console.error("Error al dar like:",s),this.removeFromFavoritesLocal(e.id),n.error(s)}})})}removeFromFavorites(e){return this.removeFromFavoritesLocal(e),new S(t=>{this.usuarioSampleService.quitarLike(this.usuarioId,e).subscribe({next:r=>{console.log("Like removido exitosamente"),t.next(r),t.complete()},error:r=>{console.error("Error al quitar like:",r),this.loadFavoritesFromBackend(),t.error(r)}})})}removeFromFavoritesLocal(e){let t=this.currentFavorites.filter(n=>n!==e),r=this.currentFavoriteSamples.filter(n=>n.id!==e);this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(r),localStorage.setItem("favoriteSamples",JSON.stringify(t))}toggleFavorite(e){return this.isFavorite(e.id)?this.removeFromFavorites(e.id):this.addToFavorites(e)}refreshFavorites(){this.loadFavoritesFromBackend()}};i.\u0275fac=function(t){return new(t||i)(_(q))},i.\u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();export{te as a,se as b};
