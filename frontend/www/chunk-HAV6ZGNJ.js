import{a as ie}from"./chunk-KAPDLRD4.js";import{b as ce}from"./chunk-KUJJENDQ.js";import{a as de}from"./chunk-XTSUAW32.js";import"./chunk-5NEJBAS5.js";import{$c as se,Ab as R,D as s,Ea as T,F as h,H as E,Hb as Y,Ja as D,K as v,M as r,Ma as V,Mb as G,Na as A,O as y,Pa as z,Q as i,Qb as U,Qc as re,R as n,Ra as F,Rc as ae,S as f,Sa as B,Sb as J,Tb as K,W as w,X as b,Xa as W,Y as _,Ya as N,_a as j,ac as Q,cd as le,da as S,ea as g,ec as X,fc as Z,gc as $,ja as C,ka as P,kc as ee,la as x,pc as te,qb as q,t as u,u as p,va as k,vb as H,vc as ne,xc as oe,ya as I,zb as L}from"./chunk-5RLBJS7C.js";import"./chunk-B6B5UJKW.js";import"./chunk-ZGM7264U.js";import"./chunk-YKTCUWBK.js";import"./chunk-WS3OVXI4.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-OWSRRI5Z.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as O}from"./chunk-RW4GY4BD.js";function me(a,d){if(a&1){let c=w();i(0,"ion-input",29),x("ngModelChange",function(t){u(c);let e=_();return P(e.currentPassword,t)||(e.currentPassword=t),p(t)}),n()}if(a&2){let c=_();C("ngModel",c.currentPassword),r("disabled",c.submitting)}}function ue(a,d){if(a&1){let c=w();i(0,"ion-input",30),x("ngModelChange",function(t){u(c);let e=_();return P(e.currentPassword,t)||(e.currentPassword=t),p(t)}),n()}if(a&2){let c=_();C("ngModel",c.currentPassword),r("disabled",c.submitting)}}function pe(a,d){a&1&&f(0,"ion-spinner",31)}function ge(a,d){a&1&&(i(0,"span"),g(1,"Actualizar Email"),n())}var Se=(()=>{let d=class d{constructor(l,t,e,o,m){this.router=l,this.themeService=t,this.autenticacionService=e,this.alertController=o,this.playerService=m,this.currentPassword="",this.newEmail="",this.showPassword=!1,this.submitting=!1,this.darkMode=!1,this.isAlertOpen=!1,this.alertMessage="",this.alertHeader="",this.isToastOpen=!1,this.toastMessage="",this.toastColor="success",this.alertButtons=[],this.subscriptions=[],ne({mailOutline:le,lockClosedOutline:se,eyeOutline:ae,eyeOffOutline:re,arrowBackOutline:oe})}ngOnInit(){let l=this.themeService.isDarkMode().subscribe(t=>{this.darkMode=t});this.subscriptions.push(l)}ngOnDestroy(){this.subscriptions.forEach(l=>l.unsubscribe())}togglePasswordVisibility(){this.showPassword=!this.showPassword}actualizarEmail(){if(!this.currentPassword||!this.newEmail){this.showToast("Todos los campos son obligatorios","warning");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.newEmail)){this.showToast("Por favor, introduce un email v\xE1lido","warning");return}this.submitting=!0;let t={password:this.currentPassword,nuevoEmail:this.newEmail};console.log("Datos para cambiar email:",t);let e=this.autenticacionService.cambiarEmail(t).subscribe({next:o=>{this.submitting=!1,this.presentarAlertaExito()},error:o=>{this.submitting=!1,console.error("Error al cambiar email:",o);let m=o.error||"Ocurri\xF3 un error inesperado.";o.status===400?this.showToast(m,"danger"):o.status===409?this.showToast(m,"danger"):this.showToast("Error desconocido al cambiar el email","danger")}});this.subscriptions.push(e)}showSuccessAlert(){this.alertHeader="Email actualizado",this.alertMessage="Tu direcci\xF3n de correo electr\xF3nico ha sido actualizada correctamente. Por seguridad, se cerrar\xE1 tu sesi\xF3n y deber\xE1s iniciar sesi\xF3n nuevamente con tu nuevo email.",this.isAlertOpen=!0}onAlertConfirm(){this.isAlertOpen=!1,this.logout(),this.router.navigate(["/login"])}showToast(l,t){this.toastMessage=l,this.toastColor=t,this.isToastOpen=!0}onToastDismiss(){this.isToastOpen=!1}goBack(){this.router.navigate(["/menu/settings"])}logout(){return O(this,null,function*(){this.router.navigate(["/login"]),this.playerService.resetState(),localStorage.clear()})}presentarAlertaExito(){this.alertHeader="Email Actualizado",this.alertMessage="Tu direcci\xF3n de email ha sido actualizada. Se cerrar\xE1 tu sesi\xF3n por seguridad.",this.alertButtons=[{text:"Aceptar",role:"confirm",handler:()=>{this.logout()}}],this.isAlertOpen=!0}onAlertDismiss(){this.isAlertOpen=!1}};d.\u0275fac=function(t){return new(t||d)(h(T),h(de),h(ie),h(ee),h(ce))},d.\u0275cmp=E({type:d,selectors:[["app-change-email"]],decls:40,vars:22,consts:[["emailForm","ngForm"],["slot","start"],["defaultHref","/menu/settings"],["id","main-content",3,"fullscreen"],[1,"content-container"],[1,"page-header"],[1,"header-icon"],["name","mail-outline"],[1,"page-title"],[1,"page-subtitle"],[1,"form-section"],[3,"ngSubmit"],[1,"form-list"],["lines","full",1,"form-item"],["position","stacked"],[1,"password-input-container"],["name","currentPassword","type","password","ngDefaultControl","","placeholder","Introduce tu contrase\xF1a para confirmar","required","",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["name","currentPassword","type","text","ngDefaultControl","","placeholder","Introduce tu contrase\xF1a para confirmar","required","",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["fill","clear","type","button",1,"visibility-toggle",3,"click","disabled"],[3,"name"],["lines","none",1,"form-item"],["name","newEmail","ngDefaultControl","","type","email","placeholder","Introduce tu nuevo email","required","","email","",3,"ngModelChange","ngModel","disabled"],[1,"form-actions"],["expand","block","type","submit",1,"update-button",3,"disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],[1,"security-info"],[3,"didDismiss","isOpen","header","message","buttons"],["position","top",3,"didDismiss","isOpen","message","duration","color"],["name","currentPassword","type","password","ngDefaultControl","","placeholder","Introduce tu contrase\xF1a para confirmar","required","",3,"ngModelChange","ngModel","disabled"],["name","currentPassword","type","text","ngDefaultControl","","placeholder","Introduce tu contrase\xF1a para confirmar","required","",3,"ngModelChange","ngModel","disabled"],["name","crescent"]],template:function(t,e){if(t&1){let o=w();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),f(3,"ion-back-button",2),n(),i(4,"ion-title"),g(5,"Cambiar Email"),n()()(),i(6,"ion-content",3)(7,"div",4)(8,"div",5)(9,"div",6),f(10,"ion-icon",7),n(),i(11,"h1",8),g(12,"Cambiar Email"),n(),i(13,"p",9),g(14,"Actualiza tu direcci\xF3n de correo electr\xF3nico"),n()(),i(15,"div",10)(16,"form",11,0),b("ngSubmit",function(){return u(o),p(e.actualizarEmail())}),i(18,"ion-list",12)(19,"ion-item",13)(20,"ion-label",14),g(21,"Contrase\xF1a actual *"),n(),i(22,"div",15),v(23,me,1,2,"ion-input",16)(24,ue,1,2,"ion-input",17),i(25,"ion-button",18),b("click",function(){return u(o),p(e.showPassword=!e.showPassword)}),f(26,"ion-icon",19),n()()(),i(27,"ion-item",20)(28,"ion-label",14),g(29,"Nuevo email *"),n(),i(30,"ion-input",21),x("ngModelChange",function(M){return u(o),P(e.newEmail,M)||(e.newEmail=M),p(M)}),n()()(),i(31,"div",22)(32,"ion-button",23),v(33,pe,1,0,"ion-spinner",24)(34,ge,2,0,"span",25),n()()(),i(35,"div",26)(36,"p"),g(37,"Por tu seguridad, despu\xE9s de cambiar el email se cerrar\xE1 tu sesi\xF3n y deber\xE1s iniciar sesi\xF3n nuevamente con tu nueva direcci\xF3n de correo electr\xF3nico."),n()()()(),i(38,"ion-alert",27),b("didDismiss",function(){return u(o),p(e.onAlertDismiss())}),n(),i(39,"ion-toast",28),b("didDismiss",function(){return u(o),p(e.onToastDismiss())}),n()()}if(t&2){let o=S(17);s(),y("dark-mode",e.darkMode),s(5),y("dark-mode",e.darkMode),r("fullscreen",!0),s(17),r("ngIf",!e.showPassword),s(),r("ngIf",e.showPassword),s(),r("disabled",e.submitting),s(),r("name",e.showPassword?"eye-off-outline":"eye-outline"),s(4),C("ngModel",e.newEmail),r("disabled",e.submitting),s(2),r("disabled",e.submitting||!o.valid),s(),r("ngIf",e.submitting),s(),r("ngIf",!e.submitting),s(4),r("isOpen",e.isAlertOpen)("header",e.alertHeader)("message",e.alertMessage)("buttons",e.alertButtons),s(),r("isOpen",e.isToastOpen)("message",e.toastMessage)("duration",3e3)("color",e.toastColor)}},dependencies:[R,q,K,te,J,U,Q,L,H,Z,Y,G,X,$,I,k,j,B,D,V,A,W,N,F,z],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: var(--background-color);font-family:Poppins,sans-serif}.content-container[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.page-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:32px;padding:24px 20px;background:linear-gradient(135deg,var(--primary-color),#f0a6c6);border-radius:20px;color:#fff;position:relative;overflow:hidden}.page-header[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 70%);animation:_ngcontent-%COMP%_shimmer 4s ease-in-out infinite}@keyframes _ngcontent-%COMP%_shimmer{0%,to{transform:translate(-100%) translateY(-100%) rotate(0)}50%{transform:translate(0) translateY(0) rotate(180deg)}}.header-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;background:#fff3;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;margin:0 auto 16px;position:relative;z-index:2}.header-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px;color:#fff}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin:0 0 8px;text-shadow:0 2px 4px rgba(0,0,0,.3);position:relative;z-index:2}.page-subtitle[_ngcontent-%COMP%]{font-size:14px;margin:0;opacity:.9;text-shadow:0 1px 2px rgba(0,0,0,.3);position:relative;z-index:2}.form-section[_ngcontent-%COMP%]{margin-bottom:32px}.form-list[_ngcontent-%COMP%]{background:var(--card-background);border-radius:16px;overflow:hidden;box-shadow:0 4px 12px #0000001a;margin-bottom:24px}.form-item[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--border-color: var(--border-color);--padding-start: 16px;--padding-end: 16px;--inner-padding-end: 8px}.form-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--text-color)!important;font-weight:600;font-size:14px;margin-bottom:8px}.form-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--color: var(--text-color);--placeholder-color: var(--text-muted);font-size:16px}.password-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.password-input-container[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{flex:1}.password-input-container[_ngcontent-%COMP%]   .visibility-toggle[_ngcontent-%COMP%]{--color: var(--text-muted);--padding-start: 8px;--padding-end: 8px;height:36px}.password-input-container[_ngcontent-%COMP%]   .visibility-toggle[_ngcontent-%COMP%]:hover{--color: var(--primary-color)}.form-actions[_ngcontent-%COMP%]{margin-bottom:24px}.update-button[_ngcontent-%COMP%]{--background: var(--primary-color);--color: white;--border-radius: 12px;height:48px;font-weight:600}.update-button[_ngcontent-%COMP%]:hover:not([disabled]){--background: #d37a9e}.security-info[_ngcontent-%COMP%]{background:rgba(var(--primary-color-rgb),.1);border-left:4px solid var(--primary-color);padding:16px;border-radius:8px}.security-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);font-size:14px;margin:0;line-height:1.5}[_nghost-%COMP%]{--background-color: #f5f5f5;--card-background: #ffffff;--text-color: #333333;--text-muted: #666666;--primary-color: #e491b4;--primary-color-rgb: 228, 145, 180;--border-color: rgba(0, 0, 0, .1)}.dark-mode[_ngcontent-%COMP%]{--background-color: #121212;--card-background: #1e1e1e;--text-color: #ffffff;--text-muted: #aaaaaa;--border-color: rgba(255, 255, 255, .1)}@media (max-width: 768px){.content-container[_ngcontent-%COMP%]{padding:16px}.page-header[_ngcontent-%COMP%]{padding:20px 16px;margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:20px}}']});let a=d;return a})();export{Se as ChangeEmailPage};
