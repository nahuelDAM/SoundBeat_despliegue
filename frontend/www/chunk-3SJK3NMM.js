import{a as B}from"./chunk-BNQ67AVA.js";import{b as S}from"./chunk-QMKYKK3D.js";import{a as z}from"./chunk-6BYM3NY5.js";import{A as d,C as x,E as _,Gc as D,H as C,J as v,Jc as U,K as O,L as w,Lc as V,M as c,Mc as J,N as u,O as h,S as I,T as y,U as m,Yb as N,a as k,aa as P,ba as F,bc as R,c as s,da as M,e as b,m as p,n as E,q as f,qa as $,r as g,ta as L,z as T}from"./chunk-XHCDBZN6.js";var H=(()=>{let i=class i{constructor(){this.currentSampleSubject=new s(null),this.isPlayingSubject=new s(!1),this.playbackProgressSubject=new s(0),this.currentPlaybackTimeSubject=new s(0),this.playlistSubject=new s([]),this.historialReproduccionSubject=new s([]),this.audioElement=null,this.currentSample$=this.currentSampleSubject.asObservable(),this.isPlaying$=this.isPlayingSubject.asObservable(),this.playbackProgress$=this.playbackProgressSubject.asObservable(),this.currentPlaybackTime$=this.currentPlaybackTimeSubject.asObservable(),this.playlist$=this.playlistSubject.asObservable(),this.historialReproduccion$=this.historialReproduccionSubject.asObservable(),this.updatePlaybackInfo=()=>{if(!this.audioElement)return;let e=this.audioElement.currentTime,t=this.audioElement.duration,r=e/t*100;this.currentPlaybackTimeSubject.next(e),this.playbackProgressSubject.next(r)},this.handleTrackEnd=()=>{this.playNext()},this.loadPlayerState(),this.loadHistorial()}get currentSample(){return this.currentSampleSubject.value}get isPlaying(){return this.isPlayingSubject.value}get playbackProgress(){return this.playbackProgressSubject.value}get currentPlaybackTime(){return this.currentPlaybackTimeSubject.value}get playlist(){return this.playlistSubject.value}get historialReproduccion(){return this.historialReproduccionSubject.value}playSample(e,t=[]){if(this.currentSample&&this.currentSample.id===e.id){this.togglePlayPause();return}this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.removeEventListener("ended",this.handleTrackEnd)),this.currentSampleSubject.next(e),t.length>0&&this.playlistSubject.next(t),this.playbackProgressSubject.next(0),this.currentPlaybackTimeSubject.next(0),this.audioElement=new Audio(e.url),this.audioElement.addEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.addEventListener("ended",this.handleTrackEnd),this.audioElement.play().then(()=>{this.isPlayingSubject.next(!0),this.addToHistorial(e),this.savePlayerState()}).catch(r=>{console.error("Error al reproducir el audio:",r),this.isPlayingSubject.next(!1)})}togglePlayPause(){!this.audioElement||!this.currentSample||(this.isPlaying?(this.audioElement.pause(),this.isPlayingSubject.next(!1)):this.audioElement.play().then(()=>{this.isPlayingSubject.next(!0)}).catch(e=>{console.error("Error al reproducir el audio:",e)}),this.savePlayerState())}playNext(){if(!this.currentSample)return;let e=this.playlist,t=e.findIndex(r=>{var a;return r.id===((a=this.currentSample)==null?void 0:a.id)});t!==-1&&t<e.length-1?this.playSample(e[t+1]):e.length>0&&this.playSample(e[0])}playPrevious(){if(!this.currentSample)return;let e=this.playlist,t=e.findIndex(r=>{var a;return r.id===((a=this.currentSample)==null?void 0:a.id)});t>0?this.playSample(e[t-1]):e.length>0&&this.playSample(e[e.length-1])}seekTo(e){if(!this.audioElement||!this.currentSample)return;let t=this.audioElement.duration,r=e/100*t;this.audioElement.currentTime=r,this.currentPlaybackTimeSubject.next(r),this.playbackProgressSubject.next(e)}stop(){this.audioElement&&(this.audioElement.pause(),this.audioElement.currentTime=0,this.isPlayingSubject.next(!1),this.playbackProgressSubject.next(0),this.currentPlaybackTimeSubject.next(0),this.savePlayerState())}addToHistorial(e){let t=[...this.historialReproduccion];t=t.filter(r=>r.id!==e.id),t.unshift(e),t.length>5&&(t=t.slice(0,5)),this.historialReproduccionSubject.next(t),localStorage.setItem("historialReproduccion",JSON.stringify(t))}loadHistorial(){let e=localStorage.getItem("historialReproduccion");if(e)try{let t=JSON.parse(e);this.historialReproduccionSubject.next(t)}catch(t){console.error("Error al cargar el historial de reproducci\xF3n:",t)}}savePlayerState(){let e={currentSample:this.currentSample,isPlaying:this.isPlaying,currentTime:this.currentPlaybackTime,playlist:this.playlist};localStorage.setItem("playerState",JSON.stringify(e))}loadPlayerState(){let e=localStorage.getItem("playerState");if(e)try{let t=JSON.parse(e);t.currentSample&&(this.currentSampleSubject.next(t.currentSample),this.playlistSubject.next(t.playlist||[]),this.isPlayingSubject.next(!1),this.currentPlaybackTimeSubject.next(t.currentTime||0),this.audioElement=new Audio(t.currentSample.url),this.audioElement.currentTime=t.currentTime||0,this.audioElement.addEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.addEventListener("ended",this.handleTrackEnd))}catch(t){console.error("Error al cargar el estado del reproductor:",t)}}ngOnDestroy(){this.audioElement&&(this.audioElement.pause(),this.audioElement.removeEventListener("timeupdate",this.updatePlaybackInfo),this.audioElement.removeEventListener("ended",this.handleTrackEnd),this.audioElement=null)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function X(o,i){if(o&1){let n=I();c(0,"div",1)(1,"div",2),y("click",function(t){f(n);let r=m();return g(r.onProgressBarClick(t))}),h(2,"div",3),u(),c(3,"div",4)(4,"div",5),h(5,"img",6),u(),c(6,"div",7)(7,"h4"),P(8),u(),c(9,"p"),P(10),u()(),c(11,"div",8)(12,"button",9),y("click",function(){f(n);let t=m();return g(t.playPrevious())}),h(13,"ion-icon",10),u(),c(14,"button",11),y("click",function(){f(n);let t=m();return g(t.togglePlayPause())}),h(15,"ion-icon",12),u(),c(16,"button",9),y("click",function(){f(n);let t=m();return g(t.playNext())}),h(17,"ion-icon",13),u()()()()}if(o&2){let n=m();w("dark-mode",n.darkMode),d(2),O("width",n.playbackProgress,"%"),d(3),v("src","/assets/img/sample-placeholder.jpg",T),d(3),F(n.currentSample.nombre),d(2),M("",n.formatDuration(n.currentPlaybackTime)," / ",n.formatDuration(n.currentSample.duracion),""),d(5),v("name",n.isPlaying?"pause":"play")}}var re=(()=>{let i=class i{constructor(e,t){this.playerService=e,this.themeService=t,this.currentSample=null,this.isPlaying=!1,this.playbackProgress=0,this.currentPlaybackTime=0,this.darkMode=!1,this.subscriptions=[],R({play:U,pause:D,playSkipBackOutline:V,playSkipForwardOutline:J})}ngOnInit(){this.subscriptions.push(this.playerService.currentSample$.subscribe(e=>{this.currentSample=e}),this.playerService.isPlaying$.subscribe(e=>{this.isPlaying=e}),this.playerService.playbackProgress$.subscribe(e=>{this.playbackProgress=e}),this.playerService.currentPlaybackTime$.subscribe(e=>{this.currentPlaybackTime=e}),this.themeService.isDarkMode().subscribe(e=>{this.darkMode=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}togglePlayPause(){this.playerService.togglePlayPause()}playNext(){this.playerService.playNext()}playPrevious(){this.playerService.playPrevious()}onProgressBarClick(e){let r=e.currentTarget.getBoundingClientRect(),l=(e.clientX-r.left)/r.width*100;this.playerService.seekTo(l)}formatDuration(e){let t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0":""}${r}`}};i.\u0275fac=function(t){return new(t||i)(x(H),x(z))},i.\u0275cmp=_({type:i,selectors:[["app-player"]],decls:1,vars:1,consts:[["class","floating-player",3,"dark-mode",4,"ngIf"],[1,"floating-player"],[1,"player-progress",3,"click"],[1,"progress-bar"],[1,"player-content"],[1,"player-thumbnail"],["alt","Sample thumbnail",3,"src"],[1,"player-info"],[1,"player-controls"],[1,"control-button",3,"click"],["name","play-skip-back-outline"],[1,"control-button","play-pause",3,"click"],[3,"name"],["name","play-skip-forward-outline"]],template:function(t,r){t&1&&C(0,X,18,9,"div",0),t&2&&v("ngIf",r.currentSample)},dependencies:[L,$,N],styles:[".floating-player[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:var(--card-background);box-shadow:0 -4px 20px #0000001a;z-index:1000;transition:all .3s ease}.player-progress[_ngcontent-%COMP%]{height:3px;background:var(--progress-background);position:relative;cursor:pointer}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--primary-color);transition:width .1s linear}.player-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 20px}.player-thumbnail[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:10px;overflow:hidden;margin-right:15px}.player-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.player-info[_ngcontent-%COMP%]{flex:1;min-width:0}.player-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:var(--text-color);margin:0 0 5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.player-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted);margin:0}.player-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.control-button[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--action-button-background);color:var(--text-color);border:none;cursor:pointer;transition:all .2s ease}.control-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.control-button.play-pause[_ngcontent-%COMP%]{width:44px;height:44px;background:var(--primary-color);color:#fff}.control-button.play-pause[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}[_nghost-%COMP%]{--background-color: #f5f5f5;--card-background: #ffffff;--text-color: #333333;--text-muted: #666666;--input-background: #f0f0f0;--input-placeholder: #9e9e9e;--primary-color: #e491b4;--border-color: rgba(0, 0, 0, .1);--tag-background: #f0f0f0;--tag-color: #666666;--action-button-background: #f5f5f5;--action-button-hover: #eeeeee;--progress-background: #eeeeee;--loader-color: #eeeeee}.dark-mode[_ngcontent-%COMP%]{--background-color: #121212;--card-background: #1e1e1e;--text-color: #ffffff;--text-muted: #aaaaaa;--input-background: #2d2d2d;--input-placeholder: #9e9e9e;--border-color: rgba(255, 255, 255, .1);--tag-background: #2d2d2d;--tag-color: #dddddd;--action-button-background: #2d2d2d;--action-button-hover: #3d3d3d;--progress-background: #2d2d2d;--loader-color: #2d2d2d}"]});let o=i;return o})();var q=(()=>{let i=class i{constructor(){this.baseUrl=`${B.URLbase}/api/usuarios-samples`}obtenerSamplesDelUsuario(e){let t=`${this.baseUrl}/${e}/samples`;return b(S.get({url:t,headers:{"Content-Type":"application/json"}}).then(r=>r.data))}darLike(e,t){let r=`${this.baseUrl}`,a={usuarioId:e,sampleId:t};return b(S.post({url:r,headers:{"Content-Type":"application/json"},data:a}).then(l=>l.data))}quitarLike(e,t){let r=`${this.baseUrl}/usuario/${e}/sample/${t}`;return b(S.delete({url:r,headers:{"Content-Type":"application/json"}}).then(a=>a.data))}existeLike(e,t){let r=`${this.baseUrl}/existe?usuarioId=${e}&sampleId=${t}`;return b(S.get({url:r,headers:{"Content-Type":"application/json"}}).then(a=>a.data))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var le=(()=>{let i=class i{constructor(e){this.usuarioSampleService=e,this.favoritesSubject=new s([]),this.favoriteSamplesSubject=new s([]),this.favorites$=this.favoritesSubject.asObservable(),this.favoriteSamples$=this.favoriteSamplesSubject.asObservable(),this.usuarioId=1,this.loadFavoritesFromBackend()}loadFavoritesFromBackend(){this.usuarioSampleService.obtenerSamplesDelUsuario(this.usuarioId).subscribe({next:e=>{let t=e.map(r=>r.id);this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(e),localStorage.setItem("favoriteSamples",JSON.stringify(t))},error:e=>{console.error("Error al cargar favoritos:",e),this.loadFromLocalStorage()}})}loadFromLocalStorage(){let e=localStorage.getItem("favoriteSamples");if(e){let t=JSON.parse(e);this.favoritesSubject.next(t)}}get currentFavorites(){return this.favoritesSubject.value}get currentFavoriteSamples(){return this.favoriteSamplesSubject.value}isFavorite(e){return this.currentFavorites.includes(e)}addToFavorites(e){let t=[...this.currentFavorites],r=[...this.currentFavoriteSamples];return t.includes(e.id)||(t.push(e.id),r.push(e),this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(r),localStorage.setItem("favoriteSamples",JSON.stringify(t))),new k(a=>{this.usuarioSampleService.darLike(this.usuarioId,e.id).subscribe({next:l=>{console.log("Like a\xF1adido exitosamente"),a.next(l),a.complete()},error:l=>{console.error("Error al dar like:",l),this.removeFromFavoritesLocal(e.id),a.error(l)}})})}removeFromFavorites(e){return this.removeFromFavoritesLocal(e),new k(t=>{this.usuarioSampleService.quitarLike(this.usuarioId,e).subscribe({next:r=>{console.log("Like removido exitosamente"),t.next(r),t.complete()},error:r=>{console.error("Error al quitar like:",r),this.loadFavoritesFromBackend(),t.error(r)}})})}removeFromFavoritesLocal(e){let t=this.currentFavorites.filter(a=>a!==e),r=this.currentFavoriteSamples.filter(a=>a.id!==e);this.favoritesSubject.next(t),this.favoriteSamplesSubject.next(r),localStorage.setItem("favoriteSamples",JSON.stringify(t))}toggleFavorite(e){return this.isFavorite(e.id)?this.removeFromFavorites(e.id):this.addToFavorites(e)}refreshFavorites(){this.loadFavoritesFromBackend()}};i.\u0275fac=function(t){return new(t||i)(E(q))},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();export{H as a,re as b,le as c};
