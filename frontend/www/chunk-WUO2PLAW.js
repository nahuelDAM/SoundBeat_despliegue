import{a as re,b as ae}from"./chunk-FLLTFSOA.js";import{a as K}from"./chunk-KAPDLRD4.js";import{a as oe}from"./chunk-XTSUAW32.js";import"./chunk-5NEJBAS5.js";import{D as r,F as g,Fb as D,Fc as X,H as U,Hb as A,Hc as Z,Hd as ie,K as b,Kb as G,M as c,O as C,Q as a,Qb as F,R as s,S as m,Sb as L,Tb as V,W as M,X as _,Y as u,_a as T,ac as N,c as y,dc as $,ea as d,fa as h,ga as S,gc as R,ic as B,k as I,kc as q,kd as ee,l as O,md as te,oc as H,pc as Y,rc as J,t as x,u as f,ua as k,va as w,vc as Q,wc as W,wd as ne,xb as z,ya as E,zb as j}from"./chunk-5RLBJS7C.js";import"./chunk-B6B5UJKW.js";import"./chunk-ZGM7264U.js";import"./chunk-YKTCUWBK.js";import"./chunk-WS3OVXI4.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-OWSRRI5Z.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as v}from"./chunk-RW4GY4BD.js";function ce(o,l){o&1&&(a(0,"div",5),m(1,"ion-spinner",6),a(2,"ion-text",7)(3,"p"),d(4,"Cargando usuarios..."),s()()())}function le(o,l){if(o&1){let n=M();a(0,"ion-item",12)(1,"ion-avatar",13)(2,"div",14),d(3),s()(),a(4,"ion-label",15)(5,"h2",16),d(6),s(),a(7,"p",17),d(8),s(),a(9,"ion-chip",18),d(10),s()(),a(11,"div",19)(12,"ion-button",20),_("click",function(){let t=x(n).$implicit,i=u(3);return f(i.openEditUserModal(t))}),m(13,"ion-icon",21),s(),a(14,"ion-button",22),_("click",function(){let t=x(n).$implicit,i=u(3);return f(i.confirmDeleteUser(t))}),m(15,"ion-icon",23),s()()()}if(o&2){let n=l.$implicit,e=u(3);C("dark-mode",e.darkMode),r(3),h(e.getUserInitials(n)),r(3),h(n.nombreUsuario),r(2),h(n.email),r(),c("color",e.getRoleColor(n.rol)),r(),S(" ",n.rol," "),r(2),c("disabled",!e.canEditUser(n)),r(2),c("disabled",!e.canDeleteUser(n))}}function de(o,l){if(o&1&&(a(0,"ion-list",10),b(1,le,16,9,"ion-item",11),s()),o&2){let n=u(2);r(),c("ngForOf",n.usersPage.content)}}function ue(o,l){if(o&1&&(a(0,"div",24),m(1,"ion-icon",25),a(2,"ion-text",7)(3,"h3"),d(4),s(),a(5,"p"),d(6),s()()()),o&2){let n=u(2);r(4),h(n.searchTerm?"No se encontraron usuarios":"No hay usuarios registrados"),r(2),h(n.searchTerm?"Intenta con otros t\xE9rminos de b\xFAsqueda":"Comienza agregando un nuevo usuario")}}function pe(o,l){if(o&1&&(a(0,"div"),b(1,de,2,1,"ion-list",8)(2,ue,7,2,"div",9),s()),o&2){let n=u();r(),c("ngIf",n.usersPage&&n.usersPage.content.length>0),r(),c("ngIf",!n.usersPage||n.usersPage.content.length===0)}}function ge(o,l){if(o&1){let n=M();a(0,"ion-footer",26)(1,"ion-toolbar")(2,"div",27)(3,"ion-text",28)(4,"small"),d(5),s()(),a(6,"div",29)(7,"ion-button",30),_("click",function(){x(n);let t=u();return f(t.previousPage())}),m(8,"ion-icon",31),d(9," Anterior "),s(),a(10,"ion-button",30),_("click",function(){x(n);let t=u();return f(t.nextPage())}),d(11," Siguiente "),m(12,"ion-icon",32),s()()()()()}if(o&2){let n=u();r(5),h(n.paginationInfo),r(2),c("disabled",!n.hasPreviousPage),r(3),c("disabled",!n.hasNextPage)}}var we=(()=>{let l=class l{constructor(e,t,i,p,P,se){this.userAdminService=e,this.themeService=t,this.modalController=i,this.toastController=p,this.alertController=P,this.loginService=se,this.isLoading=!1,this.usersPage=null,this.searchTerm="",this.darkMode=!1,this.currentUserId=null,this.currentPage=0,this.pageSize=10,this.searchSubject=new y,this.subscriptions=[],Q({pencilOutline:ee,trashOutline:ie,personOutline:te,addOutline:W,chevronBackOutline:X,chevronForwardOutline:Z,searchOutline:ne})}ngOnInit(){let e=this.loginService.idUsuario$.subscribe(p=>{this.currentUserId=p});this.subscriptions.push(e);let t=this.themeService.isDarkMode().subscribe(p=>{this.darkMode=p});this.subscriptions.push(t);let i=this.searchSubject.pipe(I(400),O()).subscribe(p=>{this.searchTerm=p,this.currentPage=0,this.loadUsers()});this.subscriptions.push(i),this.loadUsers()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadUsers(){this.isLoading=!0;let e=this.userAdminService.getUsers(this.currentPage,this.pageSize,"id,asc",this.searchTerm||void 0).subscribe({next:t=>{this.usersPage=t,this.isLoading=!1},error:t=>{console.error("Error cargando usuarios:",t),this.isLoading=!1,this.presentToast("Error al cargar los usuarios","danger")}});this.subscriptions.push(e)}onSearchChange(e){let t=e.detail.value||"";this.searchSubject.next(t)}openEditUserModal(e){return v(this,null,function*(){let t=yield this.modalController.create({component:ae,componentProps:{user:e},cssClass:this.darkMode?"modal-dark":"modal-light"});return t.onDidDismiss().then(i=>{i.data&&i.data.saved&&(this.loadUsers(),this.presentToast("Usuario actualizado exitosamente","success"))}),yield t.present()})}confirmDeleteUser(e){return v(this,null,function*(){yield(yield this.alertController.create({header:"Confirmar eliminaci\xF3n",message:`\xBFEst\xE1s seguro de que quieres eliminar al usuario <strong>${e.nombreUsuario}</strong>?`,cssClass:this.darkMode?"alert-dark":"alert-light",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",cssClass:"danger",handler:()=>{this.deleteUser(e.id)}}]})).present()})}deleteUser(e){let t=this.userAdminService.deleteUser(e).subscribe({next:()=>{this.loadUsers(),this.presentToast("Usuario eliminado exitosamente","success")},error:i=>{console.error("Error eliminando usuario:",i),this.presentToast("Error al eliminar el usuario","danger")}});this.subscriptions.push(t)}previousPage(){this.currentPage>0&&(this.currentPage--,this.loadUsers())}nextPage(){this.usersPage&&this.currentPage<this.usersPage.totalPages-1&&(this.currentPage++,this.loadUsers())}canEditUser(e){return e.rol!=="ADMIN"}canDeleteUser(e){return this.currentUserId?e.rol!=="ADMIN"&&e.id.toString()!==this.currentUserId:!1}getUserInitials(e){if(!e.nombreUsuario)return"??";let t=e.nombreUsuario.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():e.nombreUsuario.substring(0,2).toUpperCase()}getRoleColor(e){switch(e==null?void 0:e.toUpperCase()){case"ADMIN":return"danger";case"USER":return"primary";case"MODERATOR":return"warning";default:return"medium"}}get hasPreviousPage(){return this.currentPage>0}get hasNextPage(){return this.usersPage?this.currentPage<this.usersPage.totalPages-1:!1}get paginationInfo(){if(!this.usersPage)return"";let e=this.currentPage*this.pageSize+1,t=Math.min((this.currentPage+1)*this.pageSize,this.usersPage.totalElements),i=this.usersPage.totalElements;return`Mostrando ${e} - ${t} de ${i} usuarios`}presentToast(e,t){return v(this,null,function*(){(yield this.toastController.create({message:e,duration:3e3,position:"top",color:t,cssClass:this.darkMode?"toast-dark":"toast-light"})).present()})}};l.\u0275fac=function(t){return new(t||l)(g(re),g(oe),g(B),g(H),g(q),g(K))},l.\u0275cmp=U({type:l,selectors:[["app-gestion-usuarios"]],decls:5,vars:7,consts:[[3,"fullscreen"],["placeholder","Buscar por nombre o email...","debounce","0","show-clear-button","focus",3,"ionInput","value"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","pagination-footer",4,"ngIf"],[1,"loading-container"],["name","crescent","color","primary"],["color","medium"],["class","users-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"users-list"],["class","user-item",3,"dark-mode",4,"ngFor","ngForOf"],[1,"user-item"],["slot","start",1,"user-avatar"],[1,"avatar-initials"],[1,"user-info"],[1,"username"],[1,"email"],[1,"role-chip",3,"color"],["slot","end",1,"action-buttons"],["fill","clear","size","small",1,"edit-button",3,"click","disabled"],["name","pencil-outline","slot","icon-only"],["fill","clear","size","small","color","danger",1,"delete-button",3,"click","disabled"],["name","trash-outline","slot","icon-only"],[1,"empty-state"],["name","person-outline",1,"empty-icon"],[1,"pagination-footer"],[1,"pagination-container"],["color","medium",1,"pagination-info"],[1,"pagination-controls"],["fill","clear","size","small",1,"pagination-button",3,"click","disabled"],["name","chevron-back-outline","slot","start"],["name","chevron-forward-outline","slot","end"]],template:function(t,i){t&1&&(a(0,"ion-content",0)(1,"ion-searchbar",1),_("ionInput",function(P){return i.onSearchChange(P)}),s(),b(2,ce,5,0,"div",2)(3,pe,3,2,"div",3),s(),b(4,ge,13,3,"ion-footer",4)),t&2&&(C("dark-mode",i.darkMode),c("fullscreen",!0),r(),c("value",i.searchTerm),r(),c("ngIf",i.isLoading),r(),c("ngIf",!i.isLoading),r(),c("ngIf",!i.isLoading&&i.usersPage&&i.usersPage.content.length>0))},dependencies:[G,D,L,z,F,V,$,N,j,Y,J,A,R,E,k,w,T],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: var(--background-color);font-family:Poppins,sans-serif;transition:all .3s ease}ion-searchbar[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--placeholder-color: var(--text-color-secondary);--icon-color: var(--primary-color);--clear-button-color: var(--primary-color);padding:10px 16px;margin-bottom:10px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:16px}.users-list[_ngcontent-%COMP%]{background:transparent;padding:0 16px}.user-item[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--border-color: var(--border-color);--inner-border-width: 0;--padding-start: 16px;--padding-end: 16px;--min-height: 80px;margin-bottom:12px;border-radius:12px;box-shadow:var(--card-shadow);transition:all .3s ease}.user-item[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--card-shadow-hover)}.user-avatar[_ngcontent-%COMP%]{width:48px;height:48px;margin-right:16px}.avatar-initials[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--primary-color);color:#fff;font-weight:600;font-size:16px;border-radius:50%}.user-info[_ngcontent-%COMP%]{flex:1}.username[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;font-size:16px;margin-bottom:4px}.email[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:14px;margin-bottom:8px}.role-chip[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white;font-size:12px;font-weight:500;height:24px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.edit-button[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]{--color: var(--text-color-secondary);--padding-start: 8px;--padding-end: 8px;width:40px;height:40px}.edit-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.edit-button[_ngcontent-%COMP%]:hover, .delete-button[_ngcontent-%COMP%]:hover{--color: var(--primary-color)}.delete-button[_ngcontent-%COMP%]:hover{--color: var(--ion-color-danger)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--text-color-secondary);margin-bottom:20px;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:24px}.add-first-user-button[_ngcontent-%COMP%]{--color: var(--primary-color);--border-color: var(--primary-color)}.pagination-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--border-color: var(--border-color);--border-width: 1px 0 0 0}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;width:100%}.pagination-info[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color-secondary)}.pagination-controls[_ngcontent-%COMP%]{display:flex;gap:8px}.pagination-button[_ngcontent-%COMP%]{--color: var(--primary-color);--padding-start: 12px;--padding-end: 12px;font-size:14px}.pagination-button[disabled][_ngcontent-%COMP%]{--color: var(--text-color-secondary);opacity:.5}.dark-mode[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]:hover{background:var(--card-background-hover)}@media (max-width: 768px){.pagination-container[_ngcontent-%COMP%]{flex-direction:column;gap:8px;padding:12px 16px}.pagination-info[_ngcontent-%COMP%]{order:2}.pagination-controls[_ngcontent-%COMP%]{order:1}}']});let o=l;return o})();export{we as GestionUsuariosPage};
