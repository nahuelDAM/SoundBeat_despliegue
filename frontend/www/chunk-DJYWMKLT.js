import{a as Me}from"./chunk-7RXKWNF4.js";import{a as he}from"./chunk-GHRV4RSQ.js";import{a as ge}from"./chunk-BNQ67AVA.js";import{Aa as E,Bb as R,Cb as A,F as a,Gc as _e,H as p,Hb as se,Ic as be,Id as Ie,J as U,Jb as z,La as ne,Lc as ve,M as v,Mb as j,O as u,Oa as ie,Ob as $,Q as O,S as s,Sb as D,T as c,Ta as oe,U as g,Ub as le,Vb as F,Y,Z as h,_ as f,ab as T,ac as ce,c as J,cc as L,f as P,fc as de,ga as d,gc as N,ha as b,ia as y,ic as G,kc as B,l as K,la as Z,ld as xe,m as Q,ma as ee,mc as ue,na as te,nd as Ce,qc as V,r as X,rc as H,sb as re,tc as me,v as I,vc as pe,w as M,wa as k,wc as q,xa as w,xc as fe,xd as Pe,zb as ae}from"./chunk-XCE7OHUN.js";import{d as S}from"./chunk-CKJMNUPD.js";import"./chunk-B6B5UJKW.js";import"./chunk-ZGM7264U.js";import"./chunk-YKTCUWBK.js";import"./chunk-WS3OVXI4.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-OWSRRI5Z.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as x}from"./chunk-RW4GY4BD.js";var W=(()=>{let o=class o{constructor(){this.apiUrl=`${ge.URLbase}/api/admin/usuarios`}getUsers(e,t,n="id,asc",l){let m=`${this.apiUrl}?page=${e}&size=${t}&sort=${n}`;l&&(m+=`&search=${encodeURIComponent(l)}`);let _=S.get({url:m,headers:this._getAuthHeaders()}).then(C=>{if(C.status>=200&&C.status<300)return C.data;throw{status:C.status,error:C.data}});return P(_)}getUserById(e){let t=`${this.apiUrl}/${e}`,n=S.get({url:t,headers:this._getAuthHeaders()}).then(l=>{if(l.status>=200&&l.status<300)return l.data;throw{status:l.status,error:l.data}});return P(n)}updateUserRole(e,t){let n=`${this.apiUrl}/${e}/rol`,l={rol:t},m=S.put({url:n,headers:this._getAuthHeaders(),data:l}).then(_=>{if(_.status>=200&&_.status<300)return _.data;throw{status:_.status,error:_.data}});return P(m)}deleteUser(e){let t=`${this.apiUrl}/${e}`,n=S.delete({url:t,headers:this._getAuthHeaders()}).then(l=>{if(!(l.status>=200&&l.status<300))throw{status:l.status,error:l.data}});return P(n)}_getAuthHeaders(){let e=localStorage.getItem("token"),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=X({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function we(i,o){if(i&1&&(s(0,"ion-select-option",8),d(1),c()),i&2){let r=o.$implicit;u("value",r),a(),y(" ",r," ")}}function Ee(i,o){i&1&&g(0,"ion-spinner",9)}var Ue=(()=>{let o=class o{constructor(e,t,n){this.modalController=e,this.userAdminService=t,this.toastController=n,this.isLoading=!1,this.selectedRole="",this.availableRoles=["USER","ADMIN"],q({closeOutline:ve})}ngOnInit(){this.user&&(this.selectedRole=this.user.rol)}dismiss(e){this.modalController.dismiss(e)}saveChanges(){if(this.selectedRole===this.user.rol){this.dismiss();return}this.isLoading=!0,this.userAdminService.updateUserRole(this.user.id,this.selectedRole).subscribe({next:()=>{this.isLoading=!1,this.dismiss({saved:!0})},error:e=>{this.isLoading=!1,console.error("Error al actualizar el rol:",e),this.presentToast("Error al actualizar el rol.","danger")}})}presentToast(e,t){return x(this,null,function*(){(yield this.toastController.create({message:e,duration:3e3,position:"top",color:t})).present()})}};o.\u0275fac=function(t){return new(t||o)(p(B),p(W),p(V))},o.\u0275cmp=U({type:o,selectors:[["app-change-role-modal"]],inputs:{user:"user"},decls:25,vars:6,consts:[["slot","end"],[3,"click"],["name","close-outline","slot","icon-only"],[1,"ion-padding"],["label","Nuevo Rol","label-placement","stacked","ngDefaultControl","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["strong","",3,"click","disabled"],["name","crescent","slot","start",4,"ngIf"],[3,"value"],["name","crescent","slot","start"]],template:function(t,n){t&1&&(s(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),d(3,"Cambiar Rol de Usuario"),c(),s(4,"ion-buttons",0)(5,"ion-button",1),h("click",function(){return n.dismiss()}),g(6,"ion-icon",2),c()()()(),s(7,"ion-content",3)(8,"p"),d(9,"Est\xE1s editando el rol para "),s(10,"strong"),d(11),c(),d(12),c(),s(13,"ion-list")(14,"ion-item")(15,"ion-select",4),te("ngModelChange",function(m){return ee(n.selectedRole,m)||(n.selectedRole=m),m}),v(16,we,2,2,"ion-select-option",5),c()()()(),s(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",0)(20,"ion-button",1),h("click",function(){return n.dismiss()}),d(21,"Cancelar"),c(),s(22,"ion-button",6),h("click",function(){return n.saveChanges()}),v(23,Ee,1,0,"ion-spinner",7),d(24," Guardar "),c()()()()),t&2&&(a(11),b(n.user.nombreUsuario),a(),y(" (",n.user.email,")."),a(3),Z("ngModel",n.selectedRole),a(),u("ngForOf",n.availableRoles),a(6),u("disabled",n.isLoading||n.selectedRole==n.user.rol),a(),u("ngIf",n.isLoading))},dependencies:[H,D,F,L,R,A,j,z,$,N,G,E,k,w,T,ne,ie,oe,ce,pe],encapsulation:2});let i=o;return i})();function Te(i,o){i&1&&(s(0,"div",7),g(1,"ion-spinner",8),s(2,"ion-text",9)(3,"p"),d(4,"Cargando usuarios..."),c()()())}function Re(i,o){if(i&1){let r=Y();s(0,"ion-item",14)(1,"ion-avatar",15)(2,"div",16),d(3),c()(),s(4,"ion-label",17)(5,"h2",18),d(6),c(),s(7,"p",19),d(8),c(),s(9,"ion-chip",20),d(10),c()(),s(11,"div",21)(12,"ion-button",22),h("click",function(){let t=I(r).$implicit,n=f(3);return M(n.openEditUserModal(t))}),g(13,"ion-icon",23),c(),s(14,"ion-button",24),h("click",function(){let t=I(r).$implicit,n=f(3);return M(n.confirmDeleteUser(t))}),g(15,"ion-icon",25),c()()()}if(i&2){let r=o.$implicit,e=f(3);O("dark-mode",e.darkMode),a(3),b(e.getUserInitials(r)),a(3),b(r.nombreUsuario),a(2),b(r.email),a(),u("color",e.getRoleColor(r.rol)),a(),y(" ",r.rol," "),a(2),u("disabled",!e.canEditUser(r)),a(2),u("disabled",!e.canDeleteUser(r))}}function Ae(i,o){if(i&1&&(s(0,"ion-list",12),v(1,Re,16,9,"ion-item",13),c()),i&2){let r=f(2);a(),u("ngForOf",r.usersPage.content)}}function ze(i,o){if(i&1&&(s(0,"div",26),g(1,"ion-icon",27),s(2,"ion-text",9)(3,"h3"),d(4),c(),s(5,"p"),d(6),c()()()),i&2){let r=f(2);a(4),b(r.searchTerm?"No se encontraron usuarios":"No hay usuarios registrados"),a(2),b(r.searchTerm?"Intenta con otros t\xE9rminos de b\xFAsqueda":"Comienza agregando un nuevo usuario")}}function je(i,o){if(i&1&&(s(0,"div"),v(1,Ae,2,1,"ion-list",10)(2,ze,7,2,"div",11),c()),i&2){let r=f();a(),u("ngIf",r.usersPage&&r.usersPage.content.length>0),a(),u("ngIf",!r.usersPage||r.usersPage.content.length===0)}}function $e(i,o){if(i&1){let r=Y();s(0,"ion-footer",28)(1,"ion-toolbar")(2,"div",29)(3,"ion-text",30)(4,"small"),d(5),c()(),s(6,"div",31)(7,"ion-button",32),h("click",function(){I(r);let t=f();return M(t.previousPage())}),g(8,"ion-icon",33),d(9," Anterior "),c(),s(10,"ion-button",32),h("click",function(){I(r);let t=f();return M(t.nextPage())}),d(11," Siguiente "),g(12,"ion-icon",34),c()()()()()}if(i&2){let r=f();a(5),b(r.paginationInfo),a(2),u("disabled",!r.hasPreviousPage),a(3),u("disabled",!r.hasNextPage)}}var ot=(()=>{let o=class o{constructor(e,t,n,l,m,_){this.userAdminService=e,this.themeService=t,this.modalController=n,this.toastController=l,this.alertController=m,this.loginService=_,this.isLoading=!1,this.usersPage=null,this.searchTerm="",this.darkMode=!1,this.currentUserId=null,this.currentPage=0,this.pageSize=10,this.searchSubject=new J,this.subscriptions=[],q({pencilOutline:xe,trashOutline:Ie,personOutline:Ce,addOutline:fe,chevronBackOutline:_e,chevronForwardOutline:be,searchOutline:Pe})}ngOnInit(){let e=this.loginService.idUsuario$.subscribe(l=>{this.currentUserId=l});this.subscriptions.push(e);let t=this.themeService.isDarkMode().subscribe(l=>{this.darkMode=l});this.subscriptions.push(t);let n=this.searchSubject.pipe(K(400),Q()).subscribe(l=>{this.searchTerm=l,this.currentPage=0,this.loadUsers()});this.subscriptions.push(n),this.loadUsers()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadUsers(){this.isLoading=!0;let e=this.userAdminService.getUsers(this.currentPage,this.pageSize,"id,asc",this.searchTerm||void 0).subscribe({next:t=>{this.usersPage=t,this.isLoading=!1},error:t=>{console.error("Error cargando usuarios:",t),this.isLoading=!1,this.presentToast("Error al cargar los usuarios","danger")}});this.subscriptions.push(e)}onSearchChange(e){let t=e.detail.value||"";this.searchSubject.next(t)}openEditUserModal(e){return x(this,null,function*(){let t=yield this.modalController.create({component:Ue,componentProps:{user:e},cssClass:this.darkMode?"modal-dark":"modal-light"});return t.onDidDismiss().then(n=>{n.data&&n.data.saved&&(this.loadUsers(),this.presentToast("Usuario actualizado exitosamente","success"))}),yield t.present()})}confirmDeleteUser(e){return x(this,null,function*(){yield(yield this.alertController.create({header:"Confirmar eliminaci\xF3n",message:`\xBFEst\xE1s seguro de que quieres eliminar al usuario <strong>${e.nombreUsuario}</strong>?`,cssClass:this.darkMode?"alert-dark":"alert-light",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",cssClass:"danger",handler:()=>{this.deleteUser(e.id)}}]})).present()})}deleteUser(e){let t=this.userAdminService.deleteUser(e).subscribe({next:()=>{this.loadUsers(),this.presentToast("Usuario eliminado exitosamente","success")},error:n=>{console.error("Error eliminando usuario:",n),this.presentToast("Error al eliminar el usuario","danger")}});this.subscriptions.push(t)}previousPage(){this.currentPage>0&&(this.currentPage--,this.loadUsers())}nextPage(){this.usersPage&&this.currentPage<this.usersPage.totalPages-1&&(this.currentPage++,this.loadUsers())}canEditUser(e){return e.rol!=="ADMIN"}canDeleteUser(e){return this.currentUserId?e.rol!=="ADMIN"&&e.id.toString()!==this.currentUserId:!1}getUserInitials(e){if(!e.nombreUsuario)return"??";let t=e.nombreUsuario.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():e.nombreUsuario.substring(0,2).toUpperCase()}getRoleColor(e){switch(e==null?void 0:e.toUpperCase()){case"ADMIN":return"danger";case"USER":return"primary";case"MODERATOR":return"warning";default:return"medium"}}get hasPreviousPage(){return this.currentPage>0}get hasNextPage(){return this.usersPage?this.currentPage<this.usersPage.totalPages-1:!1}get paginationInfo(){if(!this.usersPage)return"";let e=this.currentPage*this.pageSize+1,t=Math.min((this.currentPage+1)*this.pageSize,this.usersPage.totalElements),n=this.usersPage.totalElements;return`Mostrando ${e} - ${t} de ${n} usuarios`}presentToast(e,t){return x(this,null,function*(){(yield this.toastController.create({message:e,duration:3e3,position:"top",color:t,cssClass:this.darkMode?"toast-dark":"toast-light"})).present()})}};o.\u0275fac=function(t){return new(t||o)(p(W),p(Me),p(B),p(V),p(ue),p(he))},o.\u0275cmp=U({type:o,selectors:[["app-gestion-usuarios"]],decls:11,vars:9,consts:[["slot","start"],["defaultHref","/menu/settings"],[3,"fullscreen"],["placeholder","Buscar por nombre o email...","debounce","0","show-clear-button","focus",3,"ionInput","value"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","pagination-footer",4,"ngIf"],[1,"loading-container"],["name","crescent","color","primary"],["color","medium"],["class","users-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"users-list"],["class","user-item",3,"dark-mode",4,"ngFor","ngForOf"],[1,"user-item"],["slot","start",1,"user-avatar"],[1,"avatar-initials"],[1,"user-info"],[1,"username"],[1,"email"],[1,"role-chip",3,"color"],["slot","end",1,"action-buttons"],["fill","clear","size","small",1,"edit-button",3,"click","disabled"],["name","pencil-outline","slot","icon-only"],["fill","clear","size","small","color","danger",1,"delete-button",3,"click","disabled"],["name","trash-outline","slot","icon-only"],[1,"empty-state"],["name","person-outline",1,"empty-icon"],[1,"pagination-footer"],[1,"pagination-container"],["color","medium",1,"pagination-info"],[1,"pagination-controls"],["fill","clear","size","small",1,"pagination-button",3,"click","disabled"],["name","chevron-back-outline","slot","start"],["name","chevron-forward-outline","slot","end"]],template:function(t,n){t&1&&(s(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g(3,"ion-back-button",1),c(),s(4,"ion-title"),d(5,"Gesti\xF3n de usuarios"),c()()(),s(6,"ion-content",2)(7,"ion-searchbar",3),h("ionInput",function(m){return n.onSearchChange(m)}),c(),v(8,Te,5,0,"div",4)(9,je,3,2,"div",5),c(),v(10,$e,13,3,"ion-footer",6)),t&2&&(a(),O("dark-mode",n.darkMode),a(5),O("dark-mode",n.darkMode),u("fullscreen",!0),a(),u("value",n.searchTerm),a(),u("ngIf",n.isLoading),a(),u("ngIf",!n.isLoading),a(),u("ngIf",!n.isLoading&&n.usersPage&&n.usersPage.content.length>0))},dependencies:[re,j,se,le,ae,D,F,de,L,R,A,H,me,z,$,N,G,E,k,w,T],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: var(--background-color);font-family:Poppins,sans-serif;transition:all .3s ease}ion-searchbar[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--placeholder-color: var(--text-color-secondary);--icon-color: var(--primary-color);--clear-button-color: var(--primary-color);padding:10px 16px;margin-bottom:10px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:16px}.users-list[_ngcontent-%COMP%]{background:transparent;padding:0 16px}.user-item[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--border-color: var(--border-color);--inner-border-width: 0;--padding-start: 16px;--padding-end: 16px;--min-height: 80px;margin-bottom:12px;border-radius:12px;box-shadow:var(--card-shadow);transition:all .3s ease}.user-item[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:var(--card-shadow-hover)}.user-avatar[_ngcontent-%COMP%]{width:48px;height:48px;margin-right:16px}.avatar-initials[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--primary-color);color:#fff;font-weight:600;font-size:16px;border-radius:50%}.user-info[_ngcontent-%COMP%]{flex:1}.username[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;font-size:16px;margin-bottom:4px}.email[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:14px;margin-bottom:8px}.role-chip[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white;font-size:12px;font-weight:500;height:24px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.edit-button[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]{--color: var(--text-color-secondary);--padding-start: 8px;--padding-end: 8px;width:40px;height:40px}.edit-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.edit-button[_ngcontent-%COMP%]:hover, .delete-button[_ngcontent-%COMP%]:hover{--color: var(--primary-color)}.delete-button[_ngcontent-%COMP%]:hover{--color: var(--ion-color-danger)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--text-color-secondary);margin-bottom:20px;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin-bottom:24px}.add-first-user-button[_ngcontent-%COMP%]{--color: var(--primary-color);--border-color: var(--primary-color)}.pagination-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--card-background);--color: var(--text-color);--border-color: var(--border-color);--border-width: 1px 0 0 0}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;width:100%}.pagination-info[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color-secondary)}.pagination-controls[_ngcontent-%COMP%]{display:flex;gap:8px}.pagination-button[_ngcontent-%COMP%]{--color: var(--primary-color);--padding-start: 12px;--padding-end: 12px;font-size:14px}.pagination-button[disabled][_ngcontent-%COMP%]{--color: var(--text-color-secondary);opacity:.5}.dark-mode[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]:hover{background:var(--card-background-hover)}ion-toolbar.dark-mode[_ngcontent-%COMP%]{--background: #1e1e1e;--color: white;box-shadow:0 1px 10px #0003}ion-toolbar.dark-mode[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{--color: #e491b4}ion-content.dark-mode[_ngcontent-%COMP%]{--background: #121212}@media (max-width: 768px){.pagination-container[_ngcontent-%COMP%]{flex-direction:column;gap:8px;padding:12px 16px}.pagination-info[_ngcontent-%COMP%]{order:2}.pagination-controls[_ngcontent-%COMP%]{order:1}}']});let i=o;return i})();export{ot as GestionUsuariosPage};
